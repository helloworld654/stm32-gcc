ARM GAS  /tmp/cc4OnNlQ.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 6
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"delay.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.bss.fac_us,"aw",%nobits
  18              	fac_us:
  19 0000 00       		.space	1
  20              		.section	.bss.fac_ms,"aw",%nobits
  21              		.align	1
  24              	fac_ms:
  25 0000 0000     		.space	2
  26              		.section	.text.delay_init,"ax",%progbits
  27              		.align	1
  28              		.global	delay_init
  29              		.arch armv7-m
  30              		.syntax unified
  31              		.thumb
  32              		.thumb_func
  33              		.fpu softvfp
  35              	delay_init:
  36              	.LFB63:
  37              		.file 1 "Src/delay.c"
   1:Src/delay.c   **** #include "delay.h"
   2:Src/delay.c   **** 
   3:Src/delay.c   **** static u8  fac_us=0;							//us延时倍乘数			   
   4:Src/delay.c   **** static u16 fac_ms=0;							//ms延时倍乘数,在ucos下,代表每个节拍的ms数
   5:Src/delay.c   **** 
   6:Src/delay.c   **** //SYSTICK的时钟固定为HCLK时钟的1/8
   7:Src/delay.c   **** //SYSCLK:系统时钟
   8:Src/delay.c   **** void delay_init()
   9:Src/delay.c   **** {
  38              		.loc 1 9 1
  39              		.cfi_startproc
  40              		@ args = 0, pretend = 0, frame = 0
  41              		@ frame_needed = 1, uses_anonymous_args = 0
  42 0000 80B5     		push	{r7, lr}
  43              	.LCFI0:
  44              		.cfi_def_cfa_offset 8
  45              		.cfi_offset 7, -8
  46              		.cfi_offset 14, -4
  47 0002 00AF     		add	r7, sp, #0
  48              	.LCFI1:
  49              		.cfi_def_cfa_register 7
  10:Src/delay.c   **** 	SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK_Div8);	//选择外部时钟  HCLK/8
  50              		.loc 1 10 2
  51 0004 6FF00400 		mvn	r0, #4
  52 0008 FFF7FEFF 		bl	SysTick_CLKSourceConfig
ARM GAS  /tmp/cc4OnNlQ.s 			page 2


  11:Src/delay.c   **** 	fac_us=SystemCoreClock/8000000;				//为系统时钟的1/8  
  53              		.loc 1 11 24
  54 000c 0B4B     		ldr	r3, .L2
  55 000e 1B68     		ldr	r3, [r3]
  56 0010 0B4A     		ldr	r2, .L2+4
  57 0012 A2FB0323 		umull	r2, r3, r2, r3
  58 0016 5B0D     		lsrs	r3, r3, #21
  59              		.loc 1 11 8
  60 0018 DAB2     		uxtb	r2, r3
  61 001a 0A4B     		ldr	r3, .L2+8
  62 001c 1A70     		strb	r2, [r3]
  12:Src/delay.c   **** 	fac_ms=(u16)fac_us*1000;					//非OS下,代表每个ms需要的systick时钟数   
  63              		.loc 1 12 8
  64 001e 094B     		ldr	r3, .L2+8
  65 0020 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
  66 0022 9BB2     		uxth	r3, r3
  67 0024 1A46     		mov	r2, r3	@ movhi
  68 0026 5201     		lsls	r2, r2, #5
  69 0028 D21A     		subs	r2, r2, r3
  70 002a 9200     		lsls	r2, r2, #2
  71 002c 1344     		add	r3, r3, r2
  72 002e DB00     		lsls	r3, r3, #3
  73 0030 9AB2     		uxth	r2, r3
  74 0032 054B     		ldr	r3, .L2+12
  75 0034 1A80     		strh	r2, [r3]	@ movhi
  13:Src/delay.c   **** }								    
  76              		.loc 1 13 1
  77 0036 00BF     		nop
  78 0038 80BD     		pop	{r7, pc}
  79              	.L3:
  80 003a 00BF     		.align	2
  81              	.L2:
  82 003c 00000000 		.word	SystemCoreClock
  83 0040 83DE1B43 		.word	1125899907
  84 0044 00000000 		.word	fac_us
  85 0048 00000000 		.word	fac_ms
  86              		.cfi_endproc
  87              	.LFE63:
  89              		.section	.text.delay_us,"ax",%progbits
  90              		.align	1
  91              		.global	delay_us
  92              		.syntax unified
  93              		.thumb
  94              		.thumb_func
  95              		.fpu softvfp
  97              	delay_us:
  98              	.LFB64:
  14:Src/delay.c   **** 
  15:Src/delay.c   **** //延时nus
  16:Src/delay.c   **** //nus为要延时的us数.		    								   
  17:Src/delay.c   **** void delay_us(u32 nus)
  18:Src/delay.c   **** {		
  99              		.loc 1 18 1
 100              		.cfi_startproc
 101              		@ args = 0, pretend = 0, frame = 16
 102              		@ frame_needed = 1, uses_anonymous_args = 0
 103              		@ link register save eliminated.
ARM GAS  /tmp/cc4OnNlQ.s 			page 3


 104 0000 80B4     		push	{r7}
 105              	.LCFI2:
 106              		.cfi_def_cfa_offset 4
 107              		.cfi_offset 7, -4
 108 0002 85B0     		sub	sp, sp, #20
 109              	.LCFI3:
 110              		.cfi_def_cfa_offset 24
 111 0004 00AF     		add	r7, sp, #0
 112              	.LCFI4:
 113              		.cfi_def_cfa_register 7
 114 0006 7860     		str	r0, [r7, #4]
  19:Src/delay.c   **** 	u32 temp;	    	 
  20:Src/delay.c   **** 	SysTick->LOAD=nus*fac_us; 					//时间加载	  		 
 115              		.loc 1 20 19
 116 0008 154B     		ldr	r3, .L7
 117 000a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 118 000c 1946     		mov	r1, r3
 119              		.loc 1 20 9
 120 000e 154A     		ldr	r2, .L7+4
 121              		.loc 1 20 19
 122 0010 7B68     		ldr	r3, [r7, #4]
 123 0012 01FB03F3 		mul	r3, r1, r3
 124              		.loc 1 20 15
 125 0016 5360     		str	r3, [r2, #4]
  21:Src/delay.c   **** 	SysTick->VAL=0x00;        					//清空计数器
 126              		.loc 1 21 9
 127 0018 124B     		ldr	r3, .L7+4
 128              		.loc 1 21 14
 129 001a 0022     		movs	r2, #0
 130 001c 9A60     		str	r2, [r3, #8]
  22:Src/delay.c   **** 	SysTick->CTRL|=SysTick_CTRL_ENABLE_Msk ;	//开始倒数	  
 131              		.loc 1 22 15
 132 001e 114B     		ldr	r3, .L7+4
 133 0020 1B68     		ldr	r3, [r3]
 134 0022 104A     		ldr	r2, .L7+4
 135 0024 43F00103 		orr	r3, r3, #1
 136 0028 1360     		str	r3, [r2]
 137              	.L6:
  23:Src/delay.c   **** 	do
  24:Src/delay.c   **** 	{
  25:Src/delay.c   **** 		temp=SysTick->CTRL;
 138              		.loc 1 25 15 discriminator 2
 139 002a 0E4B     		ldr	r3, .L7+4
 140              		.loc 1 25 7 discriminator 2
 141 002c 1B68     		ldr	r3, [r3]
 142 002e FB60     		str	r3, [r7, #12]
  26:Src/delay.c   **** 	}while((temp&0x01)&&!(temp&(1<<16)));		//等待时间到达   
 143              		.loc 1 26 14 discriminator 2
 144 0030 FB68     		ldr	r3, [r7, #12]
 145 0032 03F00103 		and	r3, r3, #1
 146              		.loc 1 26 2 discriminator 2
 147 0036 002B     		cmp	r3, #0
 148 0038 04D0     		beq	.L5
 149              		.loc 1 26 28 discriminator 1
 150 003a FB68     		ldr	r3, [r7, #12]
 151 003c 03F48033 		and	r3, r3, #65536
 152              		.loc 1 26 20 discriminator 1
ARM GAS  /tmp/cc4OnNlQ.s 			page 4


 153 0040 002B     		cmp	r3, #0
 154 0042 F2D0     		beq	.L6
 155              	.L5:
  27:Src/delay.c   **** 	SysTick->CTRL&=~SysTick_CTRL_ENABLE_Msk;	//关闭计数器
 156              		.loc 1 27 15
 157 0044 074B     		ldr	r3, .L7+4
 158 0046 1B68     		ldr	r3, [r3]
 159 0048 064A     		ldr	r2, .L7+4
 160 004a 23F00103 		bic	r3, r3, #1
 161 004e 1360     		str	r3, [r2]
  28:Src/delay.c   **** 	SysTick->VAL =0X00;      					 //清空计数器	 
 162              		.loc 1 28 9
 163 0050 044B     		ldr	r3, .L7+4
 164              		.loc 1 28 15
 165 0052 0022     		movs	r2, #0
 166 0054 9A60     		str	r2, [r3, #8]
  29:Src/delay.c   **** }
 167              		.loc 1 29 1
 168 0056 00BF     		nop
 169 0058 1437     		adds	r7, r7, #20
 170              	.LCFI5:
 171              		.cfi_def_cfa_offset 4
 172 005a BD46     		mov	sp, r7
 173              	.LCFI6:
 174              		.cfi_def_cfa_register 13
 175              		@ sp needed
 176 005c 80BC     		pop	{r7}
 177              	.LCFI7:
 178              		.cfi_restore 7
 179              		.cfi_def_cfa_offset 0
 180 005e 7047     		bx	lr
 181              	.L8:
 182              		.align	2
 183              	.L7:
 184 0060 00000000 		.word	fac_us
 185 0064 10E000E0 		.word	-536813552
 186              		.cfi_endproc
 187              	.LFE64:
 189              		.section	.text.delay_ms,"ax",%progbits
 190              		.align	1
 191              		.global	delay_ms
 192              		.syntax unified
 193              		.thumb
 194              		.thumb_func
 195              		.fpu softvfp
 197              	delay_ms:
 198              	.LFB65:
  30:Src/delay.c   **** 
  31:Src/delay.c   **** //SysTick->LOAD为24位寄存器,所以,最大延时为:
  32:Src/delay.c   **** //nms<=0xffffff*8*1000/SYSCLK
  33:Src/delay.c   **** //SYSCLK单位为Hz,nms单位为ms
  34:Src/delay.c   **** //对72M条件下,nms<=1864 
  35:Src/delay.c   **** void delay_ms(u16 nms)
  36:Src/delay.c   **** {	 		  	  
 199              		.loc 1 36 1
 200              		.cfi_startproc
 201              		@ args = 0, pretend = 0, frame = 16
ARM GAS  /tmp/cc4OnNlQ.s 			page 5


 202              		@ frame_needed = 1, uses_anonymous_args = 0
 203              		@ link register save eliminated.
 204 0000 80B4     		push	{r7}
 205              	.LCFI8:
 206              		.cfi_def_cfa_offset 4
 207              		.cfi_offset 7, -4
 208 0002 85B0     		sub	sp, sp, #20
 209              	.LCFI9:
 210              		.cfi_def_cfa_offset 24
 211 0004 00AF     		add	r7, sp, #0
 212              	.LCFI10:
 213              		.cfi_def_cfa_register 7
 214 0006 0346     		mov	r3, r0
 215 0008 FB80     		strh	r3, [r7, #6]	@ movhi
  37:Src/delay.c   **** 	u32 temp;		   
  38:Src/delay.c   **** 	SysTick->LOAD=(u32)nms*fac_ms;				//时间加载(SysTick->LOAD为24bit)
 216              		.loc 1 38 16
 217 000a FB88     		ldrh	r3, [r7, #6]
 218              		.loc 1 38 24
 219 000c 154A     		ldr	r2, .L12
 220 000e 1288     		ldrh	r2, [r2]
 221 0010 1146     		mov	r1, r2
 222              		.loc 1 38 9
 223 0012 154A     		ldr	r2, .L12+4
 224              		.loc 1 38 24
 225 0014 01FB03F3 		mul	r3, r1, r3
 226              		.loc 1 38 15
 227 0018 5360     		str	r3, [r2, #4]
  39:Src/delay.c   **** 	SysTick->VAL =0x00;							//清空计数器
 228              		.loc 1 39 9
 229 001a 134B     		ldr	r3, .L12+4
 230              		.loc 1 39 15
 231 001c 0022     		movs	r2, #0
 232 001e 9A60     		str	r2, [r3, #8]
  40:Src/delay.c   **** 	SysTick->CTRL|=SysTick_CTRL_ENABLE_Msk ;	//开始倒数  
 233              		.loc 1 40 15
 234 0020 114B     		ldr	r3, .L12+4
 235 0022 1B68     		ldr	r3, [r3]
 236 0024 104A     		ldr	r2, .L12+4
 237 0026 43F00103 		orr	r3, r3, #1
 238 002a 1360     		str	r3, [r2]
 239              	.L11:
  41:Src/delay.c   **** 	do
  42:Src/delay.c   **** 	{
  43:Src/delay.c   **** 		temp=SysTick->CTRL;
 240              		.loc 1 43 15 discriminator 2
 241 002c 0E4B     		ldr	r3, .L12+4
 242              		.loc 1 43 7 discriminator 2
 243 002e 1B68     		ldr	r3, [r3]
 244 0030 FB60     		str	r3, [r7, #12]
  44:Src/delay.c   **** 	}while((temp&0x01)&&!(temp&(1<<16)));		//等待时间到达   
 245              		.loc 1 44 14 discriminator 2
 246 0032 FB68     		ldr	r3, [r7, #12]
 247 0034 03F00103 		and	r3, r3, #1
 248              		.loc 1 44 2 discriminator 2
 249 0038 002B     		cmp	r3, #0
 250 003a 04D0     		beq	.L10
ARM GAS  /tmp/cc4OnNlQ.s 			page 6


 251              		.loc 1 44 28 discriminator 1
 252 003c FB68     		ldr	r3, [r7, #12]
 253 003e 03F48033 		and	r3, r3, #65536
 254              		.loc 1 44 20 discriminator 1
 255 0042 002B     		cmp	r3, #0
 256 0044 F2D0     		beq	.L11
 257              	.L10:
  45:Src/delay.c   **** 	SysTick->CTRL&=~SysTick_CTRL_ENABLE_Msk;	//关闭计数器
 258              		.loc 1 45 15
 259 0046 084B     		ldr	r3, .L12+4
 260 0048 1B68     		ldr	r3, [r3]
 261 004a 074A     		ldr	r2, .L12+4
 262 004c 23F00103 		bic	r3, r3, #1
 263 0050 1360     		str	r3, [r2]
  46:Src/delay.c   **** 	SysTick->VAL =0X00;       					//清空计数器	  	    
 264              		.loc 1 46 9
 265 0052 054B     		ldr	r3, .L12+4
 266              		.loc 1 46 15
 267 0054 0022     		movs	r2, #0
 268 0056 9A60     		str	r2, [r3, #8]
  47:Src/delay.c   **** } 
 269              		.loc 1 47 1
 270 0058 00BF     		nop
 271 005a 1437     		adds	r7, r7, #20
 272              	.LCFI11:
 273              		.cfi_def_cfa_offset 4
 274 005c BD46     		mov	sp, r7
 275              	.LCFI12:
 276              		.cfi_def_cfa_register 13
 277              		@ sp needed
 278 005e 80BC     		pop	{r7}
 279              	.LCFI13:
 280              		.cfi_restore 7
 281              		.cfi_def_cfa_offset 0
 282 0060 7047     		bx	lr
 283              	.L13:
 284 0062 00BF     		.align	2
 285              	.L12:
 286 0064 00000000 		.word	fac_ms
 287 0068 10E000E0 		.word	-536813552
 288              		.cfi_endproc
 289              	.LFE65:
 291              		.section	.text.delay_lms,"ax",%progbits
 292              		.align	1
 293              		.global	delay_lms
 294              		.syntax unified
 295              		.thumb
 296              		.thumb_func
 297              		.fpu softvfp
 299              	delay_lms:
 300              	.LFB66:
  48:Src/delay.c   **** 
  49:Src/delay.c   **** void delay_lms(uint16_t nms)
  50:Src/delay.c   **** {
 301              		.loc 1 50 1
 302              		.cfi_startproc
 303              		@ args = 0, pretend = 0, frame = 16
ARM GAS  /tmp/cc4OnNlQ.s 			page 7


 304              		@ frame_needed = 1, uses_anonymous_args = 0
 305 0000 80B5     		push	{r7, lr}
 306              	.LCFI14:
 307              		.cfi_def_cfa_offset 8
 308              		.cfi_offset 7, -8
 309              		.cfi_offset 14, -4
 310 0002 84B0     		sub	sp, sp, #16
 311              	.LCFI15:
 312              		.cfi_def_cfa_offset 24
 313 0004 00AF     		add	r7, sp, #0
 314              	.LCFI16:
 315              		.cfi_def_cfa_register 7
 316 0006 0346     		mov	r3, r0
 317 0008 FB80     		strh	r3, [r7, #6]	@ movhi
  51:Src/delay.c   **** 	uint8_t i,times;
  52:Src/delay.c   **** 	times = nms/1500;
 318              		.loc 1 52 8
 319 000a FB88     		ldrh	r3, [r7, #6]
 320 000c 194A     		ldr	r2, .L19
 321 000e A2FB0323 		umull	r2, r3, r2, r3
 322 0012 5B09     		lsrs	r3, r3, #5
 323 0014 9BB2     		uxth	r3, r3
 324 0016 BB73     		strb	r3, [r7, #14]
  53:Src/delay.c   **** 	for(i=0;i<times;i++)
 325              		.loc 1 53 7
 326 0018 0023     		movs	r3, #0
 327 001a FB73     		strb	r3, [r7, #15]
 328              		.loc 1 53 2
 329 001c 06E0     		b	.L15
 330              	.L16:
  54:Src/delay.c   **** 		delay_ms(1500);
 331              		.loc 1 54 3 discriminator 3
 332 001e 40F2DC50 		movw	r0, #1500
 333 0022 FFF7FEFF 		bl	delay_ms
  53:Src/delay.c   **** 	for(i=0;i<times;i++)
 334              		.loc 1 53 19 discriminator 3
 335 0026 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 336 0028 0133     		adds	r3, r3, #1
 337 002a FB73     		strb	r3, [r7, #15]
 338              	.L15:
  53:Src/delay.c   **** 	for(i=0;i<times;i++)
 339              		.loc 1 53 2 discriminator 1
 340 002c FA7B     		ldrb	r2, [r7, #15]	@ zero_extendqisi2
 341 002e BB7B     		ldrb	r3, [r7, #14]	@ zero_extendqisi2
 342 0030 9A42     		cmp	r2, r3
 343 0032 F4D3     		bcc	.L16
  55:Src/delay.c   **** 	if(nms%1500)
 344              		.loc 1 55 5
 345 0034 FB88     		ldrh	r3, [r7, #6]
 346 0036 0F4A     		ldr	r2, .L19
 347 0038 A2FB0312 		umull	r1, r2, r2, r3
 348 003c 5209     		lsrs	r2, r2, #5
 349 003e 40F2DC51 		movw	r1, #1500
 350 0042 01FB02F2 		mul	r2, r1, r2
 351 0046 9B1A     		subs	r3, r3, r2
 352 0048 9BB2     		uxth	r3, r3
 353              		.loc 1 55 4
ARM GAS  /tmp/cc4OnNlQ.s 			page 8


 354 004a 002B     		cmp	r3, #0
 355 004c 0DD0     		beq	.L18
  56:Src/delay.c   **** 		delay_ms(nms%1500);
 356              		.loc 1 56 3
 357 004e FB88     		ldrh	r3, [r7, #6]
 358 0050 084A     		ldr	r2, .L19
 359 0052 A2FB0312 		umull	r1, r2, r2, r3
 360 0056 5209     		lsrs	r2, r2, #5
 361 0058 40F2DC51 		movw	r1, #1500
 362 005c 01FB02F2 		mul	r2, r1, r2
 363 0060 9B1A     		subs	r3, r3, r2
 364 0062 9BB2     		uxth	r3, r3
 365 0064 1846     		mov	r0, r3
 366 0066 FFF7FEFF 		bl	delay_ms
 367              	.L18:
  57:Src/delay.c   **** }
 368              		.loc 1 57 1
 369 006a 00BF     		nop
 370 006c 1037     		adds	r7, r7, #16
 371              	.LCFI17:
 372              		.cfi_def_cfa_offset 8
 373 006e BD46     		mov	sp, r7
 374              	.LCFI18:
 375              		.cfi_def_cfa_register 13
 376              		@ sp needed
 377 0070 80BD     		pop	{r7, pc}
 378              	.L20:
 379 0072 00BF     		.align	2
 380              	.L19:
 381 0074 F1197605 		.word	91625969
 382              		.cfi_endproc
 383              	.LFE66:
 385              		.text
 386              	.Letext0:
 387              		.file 2 "/home/pico/tools/gcc-arm-none-eabi-10-2020-q4-major/arm-none-eabi/include/machine/_defaul
 388              		.file 3 "/home/pico/tools/gcc-arm-none-eabi-10-2020-q4-major/arm-none-eabi/include/sys/_stdint.h"
 389              		.file 4 "Drivers/CMSIS/Include/core_cm3.h"
 390              		.file 5 "Inc/stm32f10x.h"
 391              		.file 6 "Inc/system_stm32f10x.h"
ARM GAS  /tmp/cc4OnNlQ.s 			page 9


DEFINED SYMBOLS
                            *ABS*:0000000000000000 delay.c
     /tmp/cc4OnNlQ.s:18     .bss.fac_us:0000000000000000 fac_us
     /tmp/cc4OnNlQ.s:19     .bss.fac_us:0000000000000000 $d
     /tmp/cc4OnNlQ.s:21     .bss.fac_ms:0000000000000000 $d
     /tmp/cc4OnNlQ.s:24     .bss.fac_ms:0000000000000000 fac_ms
     /tmp/cc4OnNlQ.s:27     .text.delay_init:0000000000000000 $t
     /tmp/cc4OnNlQ.s:35     .text.delay_init:0000000000000000 delay_init
     /tmp/cc4OnNlQ.s:82     .text.delay_init:000000000000003c $d
     /tmp/cc4OnNlQ.s:90     .text.delay_us:0000000000000000 $t
     /tmp/cc4OnNlQ.s:97     .text.delay_us:0000000000000000 delay_us
     /tmp/cc4OnNlQ.s:184    .text.delay_us:0000000000000060 $d
     /tmp/cc4OnNlQ.s:190    .text.delay_ms:0000000000000000 $t
     /tmp/cc4OnNlQ.s:197    .text.delay_ms:0000000000000000 delay_ms
     /tmp/cc4OnNlQ.s:286    .text.delay_ms:0000000000000064 $d
     /tmp/cc4OnNlQ.s:292    .text.delay_lms:0000000000000000 $t
     /tmp/cc4OnNlQ.s:299    .text.delay_lms:0000000000000000 delay_lms
     /tmp/cc4OnNlQ.s:381    .text.delay_lms:0000000000000074 $d

UNDEFINED SYMBOLS
SysTick_CLKSourceConfig
SystemCoreClock
